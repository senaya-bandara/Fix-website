<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fix — Find trusted help nearby</title>
  <meta name="description" content="Fix is a hyperlocal marketplace to book trusted help for care, home and events." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
          colors: {
            fix: {
              50:'#ecfbf3',100:'#d3f6e3',200:'#a8ecc8',300:'#7de1ae',400:'#61d999',
              500:'#4EC67E',  /* primary */
              600:'#3fb870',700:'#2fa861',800:'#238a4f',900:'#1b6d3f'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.08)'
          }
        }
      }
    }
  </script>
  <style>
    html, body { height:100%; }
    .glass { backdrop-filter: blur(8px); background: rgba(255,255,255,.7); }
    .clip-blob { clip-path: path('M40 0C68 0 90 18 100 45c10 27 5 54-12 72S47 139 25 130 0 98 0 70 12 0 40 0z'); }
  </style>
</head>
<body class="text-slate-800">
  <!-- Full-page background gradient -->
  <div class="fixed inset-0 -z-50">
    <div class="absolute inset-0 bg-gradient-to-br from-[#4EC67E] via-[#1F6D47] to-[#0B3E29]"></div>
    <div class="absolute inset-0 bg-[radial-gradient(60%_80%_at_70%_10%,rgba(255,255,255,0.18),transparent_60%)]"></div>
  </div>

  <!-- Top Bar -->
  <header class="relative">
    <div class="absolute inset-0 -z-10 bg-gradient-to-br from-[#4EC67E] via-[#1F6D47] to-[#0B3E29] opacity-95"></div>
    <div class="absolute right-[-80px] top-[-80px] w-[280px] h-[280px] clip-blob bg-white/10"></div>

    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-white/90 flex items-center justify-center shadow-soft">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 text-fix-600">
            <path fill="currentColor" d="M5 13h5v6H5zm9-8h5v14h-5zM5 5h5v6H5zm9 10h5v4h-5z"/>
          </svg>
        </div>
        <a href="#home" class="text-white text-2xl font-extrabold tracking-tight">Fix</a>
      </div>

      <!-- Separated menu -->
      <div class="hidden md:flex items-center text-white/90 font-medium divide-x divide-white/25">
        <a href="#browse" class="px-3 hover:text-white">Browse</a>
        <a href="#requests" class="px-3 hover:text-white">Requests</a>
        <a href="#become-pro" class="px-3 hover:text-white">Become a Pro</a>
        <a href="#bookings" class="px-3 hover:text-white">My Bookings</a>
      </div>

      <!-- Right side: Sign in + Bell + Post -->
      <div class="flex items-center gap-3">
        <button id="btn-login" class="hidden md:inline-flex px-4 py-2 rounded-xl bg-white text-fix-700 font-semibold shadow-soft hover:bg-slate-100">Sign in</button>

        <!-- Bell next to Sign in -->
        <button id="notify-btn-nav" class="p-2 rounded-full bg-white/90 text-fix-700 shadow-soft hover:bg-white focus:outline-none focus:ring-2 focus:ring-white/60 relative" aria-label="Notifications">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 3a6 6 0 00-6 6v2.268c0 .58-.223 1.138-.62 1.553L4 14h16l-1.38-1.179a2.2 2.2 0 01-.62-1.553V9a6 6 0 00-6-6zm0 18a3 3 0 01-2.995-2.824L9 18h6a3 3 0 01-2.824 2.995L12 21z"/>
          </svg>
          <span id="notify-badge" class="absolute -top-1 -right-1 min-w-[1.25rem] h-5 px-1 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center">3</span>
        </button>

        <button id="btn-post" class="px-4 py-2 rounded-xl bg-fix-600 text-white font-semibold shadow-soft hover:bg-fix-700">Post a Request</button>
      </div>
    </nav>

    <!-- Hero -->
    <section id="home" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-20 text-white">
      <div class="grid lg:grid-cols-2 gap-10 items-center">
        <div>
          <h1 class="text-4xl lg:text-6xl font-extrabold leading-tight">Find trusted help, <span class="underline decoration-emerald-300">right now</span>.</h1>
          <p class="mt-4 text-white/90 text-lg">Care, home, events, wellness — Fix matches you with verified local professionals in minutes. Transparent rates. Reviews you can trust.</p>
          <div class="mt-8 bg-white/10 rounded-2xl p-4 glass shadow-soft">
            <form id="search-form" class="grid md:grid-cols-5 gap-3">
              <div class="md:col-span-2">
                <label class="block text-sm text-white/80 mb-1">Service</label>
                <input id="q-service" type="text" placeholder="elder care, cleaning, driver…" class="w-full px-4 py-3 rounded-xl bg-white/90 text-slate-800 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-300" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm text-white/80 mb-1">Location</label>
                <input id="q-location" type="text" placeholder="Colombo, Kandy…" class="w-full px-4 py-3 rounded-xl bg-white/90 text-slate-800 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-300" />
              </div>
              <div>
                <label class="block text-sm text-white/80 mb-1">Date</label>
                <input id="q-date" type="date" class="w-full px-4 py-3 rounded-xl bg-white/90 text-slate-800 focus:outline-none focus:ring-2 focus:ring-emerald-300" />
              </div>
              <div class="md:col-span-5 flex gap-3 mt-2">
                <button class="px-5 py-3 rounded-xl bg-emerald-400 text-slate-900 font-semibold hover:bg-emerald-300" type="submit">Search</button>
                <a href="#browse" class="px-5 py-3 rounded-xl bg-white/90 text-fix-700 font-semibold hover:bg-white">See all</a>
              </div>
            </form>
          </div>
          <div class="mt-6 flex items-center gap-6 text-white/80">
            <div class="flex items-center gap-2"><span class="font-bold text-white">1,200+</span> verified pros</div>
            <div class="flex items-center gap-2"><span class="font-bold text-white">4.8★</span> average rating</div>
            <div class="flex items-center gap-2">Insurance-ready</div>
          </div>
        </div>
        <div class="relative">
          <div class="absolute -top-6 -left-6 w-40 h-40 rounded-3xl bg-white/10"></div>
          <div class="relative bg-white rounded-3xl p-6 shadow-soft">
            <h3 class="text-slate-900 font-bold text-xl">Trending near you</h3>
            <ul id="trending" class="mt-4 grid grid-cols-2 gap-4"></ul>
          </div>
        </div>
      </div>
    </section>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <!-- Filters & Browse -->
    <section id="browse" class="space-y-6">
      <div class="flex items-end justify-between gap-4 flex-wrap">
        <div>
          <h2 class="text-2xl font-extrabold text-white">Browse providers</h2>
          <p class="text-[#E6FFF1]">Filter by category, location, and rating</p>
        </div>
        <div class="flex gap-3">
          <select id="filter-category" class="px-4 py-2 rounded-xl bg-white border border-slate-200">
            <option value="">All categories</option>
          </select>
          <select id="filter-location" class="px-4 py-2 rounded-xl bg-white border border-slate-200">
            <option value="">All locations</option>
          </select>
          <select id="sort-by" class="px-4 py-2 rounded-xl bg-white border border-slate-200">
            <option value="top">Sort: Top rated</option>
            <option value="price-asc">Price: Low → High</option>
            <option value="price-desc">Price: High → Low</option>
          </select>
        </div>
      </div>

      <div id="providers-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- Requests Board -->
    <section id="requests" class="space-y-6 mt-16">
      <div class="flex items-end justify-between gap-4 flex-wrap">
        <div>
          <h2 class="text-2xl font-extrabold text-white">Open requests</h2>
          <p class="text-[#E6FFF1]">Post what you need and get offers</p>
        </div>
        <button id="btn-post-2" class="px-4 py-2 rounded-xl bg-fix-600 text-white font-semibold shadow-soft hover:bg-fix-700">Post a Request</button>
      </div>
      <div id="requests-list" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- Become a Pro -->
    <section id="become-pro" class="space-y-6 mt-16">
      <h2 class="text-2xl font-extrabold text-white">Become a Pro on Fix</h2>
      <p class="text-[#E6FFF1]">Verify your identity, set your rates, and get booked by nearby clients.</p>
      <form id="pro-form" class="grid md:grid-cols-2 gap-4 bg-white rounded-2xl p-6 shadow-soft">
        <div>
          <label class="block text-sm font-medium mb-1">Full name</label>
          <input required id="pro-name" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Jane Perera"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Phone</label>
          <input required id="pro-phone" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="07x xxx xxxx"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Category</label>
          <select required id="pro-category" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"></select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Location</label>
          <select required id="pro-location" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"></select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Rate (LKR/hour)</label>
          <input required id="pro-rate" type="number" min="100" step="50" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Languages</label>
          <input id="pro-languages" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Sinhala, Tamil, English"/>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1">About you</label>
          <textarea id="pro-bio" rows="3" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Short bio and experience"></textarea>
        </div>
        <div class="md:col-span-2 flex items-center gap-2">
          <input id="pro-verified" type="checkbox" class="w-4 h-4"/>
          <label for="pro-verified" class="text-sm">I have uploaded ID for verification <span class="text-slate-500">(simulated)</span></label>
        </div>
        <div class="md:col-span-2">
          <button class="px-5 py-3 rounded-xl bg-emerald-400 text-slate-900 font-semibold hover:bg-emerald-300">Create profile</button>
        </div>
      </form>
    </section>
  </main>

  <!-- Footer -->
  <footer class="mt-20 border-t border-slate-200 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid md:grid-cols-4 gap-8">
      <div>
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 rounded-xl bg-fix-500"></div>
          <div class="text-xl font-extrabold">Fix</div>
        </div>
        <p class="text-slate-600 mt-3">A hyperlocal marketplace for trusted human services. Built for Sri Lanka.</p>
      </div>
      <div>
        <h4 class="font-bold mb-2">Explore</h4>
        <ul class="space-y-1 text-slate-600">
          <li><a href="#browse" class="hover:text-fix-600">Browse providers</a></li>
          <li><a href="#requests" class="hover:text-fix-600">Open requests</a></li>
          <li><a href="#become-pro" class="hover:text-fix-600">Become a pro</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold mb-2">Company</h4>
        <ul class="space-y-1 text-slate-600">
          <li><a href="#" class="hover:text-fix-600">About</a></li>
          <li><a href="#" class="hover:text-fix-600">Trust & Safety</a></li>
          <li><a href="#" class="hover:text-fix-600">Terms & Privacy</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-bold mb-2">Get the app</h4>
        <div class="flex gap-3">
          <div class="h-12 w-36 bg-slate-200 rounded-xl"></div>
          <div class="h-12 w-36 bg-slate-200 rounded-xl"></div>
        </div>
      </div>
    </div>
    <div class="border-t border-slate-200 py-6 text-center text-slate-500 text-sm">© <span id="year"></span> Fix. All rights reserved.</div>
  </footer>

  <!-- Book Modal -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4 z-50">
    <div class="bg-white max-w-lg w-full rounded-2xl shadow-soft overflow-hidden">
      <div class="px-6 py-4 border-b border-slate-200 flex items-center justify-between">
        <h3 class="font-bold text-lg">Book provider</h3>
        <button id="modal-close" class="p-2 hover:bg-slate-100 rounded-lg">✕</button>
      </div>
      <div class="p-6 space-y-4" id="modal-body"></div>
    </div>
  </div>

  <!-- Post Request Modal -->
  <div id="post-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4 z-50">
    <div class="bg-white max-w-xl w-full rounded-2xl shadow-soft overflow-hidden">
      <div class="px-6 py-4 border-b border-slate-200 flex items-center justify-between">
        <h3 class="font-bold text-lg">Post a request</h3>
        <button id="post-close" class="p-2 hover:bg-slate-100 rounded-lg">✕</button>
      </div>
      <form id="request-form" class="p-6 grid gap-3">
        <div>
          <label class="block text-sm font-medium mb-1">What do you need?</label>
          <input required id="req-title" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Elder care companion for 3 days"/>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium mb-1">Location</label>
            <select required id="req-location" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"></select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Budget (LKR)</label>
            <input required type="number" id="req-budget" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="15000"/>
          </div>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium mb-1">Date</label>
            <input required type="date" id="req-date" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"/>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Contact</label>
            <input required id="req-contact" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Your phone or email"/>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Details</label>
          <textarea id="req-details" rows="3" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Any special needs or preferences"></textarea>
        </div>
        <div class="flex justify-end gap-3 mt-2">
          <button type="button" id="req-cancel" class="px-4 py-2 rounded-xl bg-slate-100">Cancel</button>
          <button class="px-4 py-2 rounded-xl bg-fix-600 text-white font-semibold hover:bg-fix-700">Post</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ------- Data layer (localStorage simulation) -------
    const seedProviders = [
      { id: 'p1', name: 'Nimali Jayasinghe', category: 'Elder care', location: 'Colombo', rate: 2500, rating: 4.9, verified: true, languages: 'Sinhala, English', bio: 'Compassionate caregiver with 6+ years hospital experience. First aid certified.' },
      { id: 'p2', name: 'Ravi Kannan', category: 'Driving', location: 'Kandy', rate: 1800, rating: 4.6, verified: false, languages: 'Tamil, Sinhala', bio: 'Professional driver with clean record. Airport pickups, day hires.' },
      { id: 'p3', name: 'Ishara Perera', category: 'Cleaning', location: 'Colombo', rate: 1200, rating: 4.7, verified: true, languages: 'Sinhala', bio: 'Deep cleaning specialist for apartments and offices.' },
      { id: 'p4', name: 'Thushara Ranathunga', category: 'Cooking', location: 'Gampaha', rate: 1500, rating: 4.5, verified: true, languages: 'Sinhala', bio: 'Home-cooked Sri Lankan meals; vegetarian options available.' },
      { id: 'p5', name: 'Naveen Nadarajah', category: 'Physiotherapy', location: 'Jaffna', rate: 3000, rating: 4.8, verified: true, languages: 'Tamil, English', bio: 'Licensed physio for post-op recovery and mobility.' },
      { id: 'p6', name: 'Dilini Fernando', category: 'Babysitting', location: 'Colombo', rate: 2200, rating: 4.9, verified: true, languages: 'Sinhala, English', bio: 'Early childhood trained nanny. CPR certified.' },
      { id: 'p7', name: 'Sunethra Silva', category: 'Elder care', location: 'Galle', rate: 2000, rating: 4.4, verified: false, languages: 'Sinhala', bio: 'Patient and reliable elder companion for day duties.' },
      { id: 'p8', name: 'Ahamed Rizvi', category: 'Event staff', location: 'Matara', rate: 1700, rating: 4.3, verified: true, languages: 'Sinhala, English', bio: 'Event waiter and setup crew for weddings and parties.' }
    ];

    const CATEGORIES = ['Elder care','Babysitting','Cleaning','Cooking','Driving','Event staff','Physiotherapy','Errands'];
    const LOCATIONS  = ['Colombo','Gampaha','Kandy','Galle','Matara','Jaffna','Negombo','Kalutara'];

    const db = {
      load() {
        const data = JSON.parse(localStorage.getItem('fix-db') || '{}');
        if (!data.providers) data.providers = seedProviders;
        if (!data.requests)  data.requests  = [];
        if (!data.bookings)  data.bookings  = [];
        localStorage.setItem('fix-db', JSON.stringify(data));
        return data;
      },
      save(data){ localStorage.setItem('fix-db', JSON.stringify(data)); }
    }

    let state = db.load();

    // ------- Helpers -------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmt = n => new Intl.NumberFormat('en-LK').format(n);

    function badge(text, tone='emerald'){
      return `<span class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-${tone}-50 text-${tone}-700 border border-${tone}-200">${text}</span>`
    }

    function starRating(r){
      const full = Math.floor(r); const half = r - full >= .5; const empty = 5 - full - (half ? 1 : 0);
      return '<div class="flex items-center gap-0.5">'
        + '★'.repeat(full)
        + (half ? '☆' : '')
        + '✩'.repeat(empty)
        + `<span class="ml-1 text-sm text-slate-600">${r.toFixed(1)}</span>`
        + '</div>'
    }

    // ------- Populate filters & hero -------
    function initFilters(){
      const catSel = $('#filter-category');
      const locSel = $('#filter-location');
      const proCat = $('#pro-category');
      const proLoc = $('#pro-location');
      const reqLoc = $('#req-location');

      CATEGORIES.forEach(c=>{
        [catSel, proCat].forEach(s=>{ const o=document.createElement('option'); o.value=o.textContent=c; s.appendChild(o); });
      });
      LOCATIONS.forEach(l=>{
        [locSel, proLoc, reqLoc].forEach(s=>{ const o=document.createElement('option'); o.value=o.textContent=l; s.appendChild(o); });
      });

      const trending = $('#trending');

      // New trending cards with sample names
      const data = {
        'Elder care': ['Nimali Jayasinghe','Sunethra Silva','Anoma de Silva'],
        'Cleaning': ['Ishara Perera','Kasun Madushanka','Tharushi Senanayake'],
        'Babysitting': ['Dilini Fernando','Menaka Peiris','Ruwani Hettiarachchi'],
        'Driving': ['Ravi Kannan','Saman Kumara','Tharaka Jayasuriya']
      };
      const topCats = Object.keys(data);
      trending.innerHTML = topCats.map(c=>{
        const names = data[c];
        return `
          <li class="p-4 rounded-xl border border-slate-200 hover:shadow-soft transition bg-white">
            <div class="text-xs uppercase tracking-wide text-fix-700">Popular</div>
            <div class="font-bold text-slate-900 mt-1">${c}</div>
            <ul class="mt-2 text-slate-700 text-sm space-y-1">
              ${names.map(n=>`<li class="px-2 py-1 rounded-lg bg-slate-50 border border-slate-200">${n}</li>`).join('')}
            </ul>
            <a href="#browse" data-cat="${c}" class="mt-3 inline-flex text-fix-600 hover:underline">Explore →</a>
          </li>
        `;
      }).join('');

      trending.querySelectorAll('a[data-cat]').forEach(a=>a.addEventListener('click', e=>{
        e.preventDefault();
        catSel.value = a.dataset.cat; renderProviders(); location.hash = '#browse';
      }));
    }

    // ------- Render providers -------
    function renderProviders(){
      const grid = $('#providers-grid');
      let items = [...state.providers];
      const cat = $('#filter-category').value;
      const loc = $('#filter-location').value;
      const sort= $('#sort-by').value;

      if (cat) items = items.filter(p=>p.category===cat);
      if (loc) items = items.filter(p=>p.location===loc);
      if (sort==='top') items.sort((a,b)=>b.rating-a.rating);
      if (sort==='price-asc') items.sort((a,b)=>a.rate-b.rate);
      if (sort==='price-desc') items.sort((a,b)=>b.rate-a.rate);

      const html = items.map(p=>`
        <article class="bg-white rounded-2xl p-5 border border-slate-200 shadow-soft hover:-translate-y-0.5 transition">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 class="text-lg font-bold">${p.name}</h3>
              <div class="mt-1 text-slate-600">${p.category} • ${p.location}</div>
              <div class="mt-2 flex items-center gap-2">${starRating(p.rating)} ${p.verified?badge('Verified','fix'):''}</div>
            </div>
            <div class="text-right">
              <div class="text-xl font-extrabold">LKR ${fmt(p.rate)}</div>
              <div class="text-sm text-slate-600">per hour</div>
            </div>
          </div>
          <p class="mt-3 text-slate-700">${p.bio}</p>
          <div class="mt-3 text-sm text-slate-600">Languages: ${p.languages||'—'}</div>
          <div class="mt-4 flex gap-2">
            <button class="px-4 py-2 rounded-xl bg-fix-500 text-white font-semibold hover:bg-fix-600" data-book="${p.id}">Book</button>
            <button class="px-4 py-2 rounded-xl bg-slate-100" data-contact="${p.id}">Contact</button>
          </div>
        </article>
      `).join('');

      grid.innerHTML = html || `<div class="col-span-full text-[#E6FFF1]">No providers match your filters.</div>`;
    }

    // ------- Requests board -------
    function renderRequests(){
      const list = $('#requests-list');
      list.innerHTML = state.requests.map((r,i)=>`
        <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-soft">
          <div class="flex items-center justify-between">
            <h3 class="font-bold">${r.title}</h3>
            ${badge(r.location,'fix')}
          </div>
          <div class="mt-1 text-slate-600 text-sm">Needed on ${r.date}</div>
          <p class="mt-2">${r.details||''}</p>
          <div class="mt-3 font-semibold">Budget: LKR ${fmt(r.budget)}</div>
          <div class="mt-4 flex gap-2">
            <button class="px-4 py-2 rounded-xl bg-emerald-400 text-slate-900 font-semibold" data-offer="${i}">Offer service</button>
            <button class="px-4 py-2 rounded-xl bg-slate-100" data-contactreq="${i}">Contact</button>
          </div>
        </div>
      `).join('') || `<div class="text-[#E6FFF1]">No requests yet. Be the first to post!</div>`;

      list.querySelectorAll('[data-offer]').forEach(btn=>btn.addEventListener('click',()=>alert('Offer sent (simulated).')));
      list.querySelectorAll('[data-contactreq]').forEach(btn=>btn.addEventListener('click',()=>alert('Contact shared (simulated).')));
    }

    // ------- Book modal -------
    function openBookModal(pid){
      const p = state.providers.find(x=>x.id===pid);
      if(!p) return;
      const body = $('#modal-body');
      body.innerHTML = `
        <div class="space-y-1">
          <div class="text-sm text-slate-600">Provider</div>
          <div class="font-bold text-lg">${p.name} — ${p.category}</div>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium mb-1">Date</label>
            <input id="bk-date" type="date" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"/>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Hours</label>
            <input id="bk-hours" type="number" min="1" value="3" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200"/>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Address</label>
          <input id="bk-address" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="123, Flower Rd, Colombo 7"/>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Notes</label>
          <textarea id="bk-notes" rows="2" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200" placeholder="Any special instructions"></textarea>
        </div>
        <div class="flex items-center justify-between bg-slate-50 rounded-xl p-3">
          <div>Rate: <span class="font-semibold">LKR ${fmt(p.rate)}/hr</span></div>
          <div id="bk-total" class="text-lg font-extrabold">Total: LKR ${fmt(p.rate*3)}</div>
        </div>
        <div class="flex justify-end gap-3">
          <button id="bk-cancel" class="px-4 py-2 rounded-xl bg-slate-100">Cancel</button>
          <button id="bk-confirm" class="px-4 py-2 rounded-xl bg-fix-500 text-white font-semibold hover:bg-fix-600">Confirm booking</button>
        </div>`;

      const hours = $('#bk-hours');
      const total = ()=> $('#bk-total').textContent = 'Total: LKR ' + fmt(p.rate * Math.max(1, Number(hours.value||1)));
      hours.addEventListener('input', total);

      $('#bk-cancel').onclick = closeModal;
      $('#bk-confirm').onclick = ()=>{
        const b = {
          id: 'b'+Date.now(), providerId: p.id, providerName: p.name, category: p.category,
          date: $('#bk-date').value, hours: Number($('#bk-hours').value||1),
          address: $('#bk-address').value, notes: $('#bk-notes').value, rate: p.rate,
          total: p.rate * Math.max(1, Number($('#bk-hours').value||1)),
          status: 'Confirmed'
        };
        state.bookings.unshift(b); db.save(state); renderBookings(); closeModal();
        alert('Booking confirmed! (simulated)');
      }

      document.getElementById('modal').classList.remove('hidden');
      document.getElementById('modal').classList.add('flex');
    }

    function closeModal(){
      document.getElementById('modal').classList.add('hidden');
      document.getElementById('modal').classList.remove('flex');
    }

    document.getElementById('modal-close').addEventListener('click', closeModal);

    // ------- Render bookings -------
    function renderBookings(){
      const list = $('#bookings-list');
      list.innerHTML = state.bookings.map(b=>`
        <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-soft">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-bold">${b.providerName}</div>
              <div class="text-slate-600 text-sm">${b.category} • ${b.date} • ${b.hours}h</div>
            </div>
            <div class="text-right">
              <div class="font-extrabold">LKR ${fmt(b.total)}</div>
              ${badge(b.status, b.status==='Confirmed'?'emerald':'slate')}
            </div>
          </div>
          <div class="mt-3 text-sm text-slate-700">${b.address}</div>
          <div class="mt-4 flex gap-2">
            <button class="px-4 py-2 rounded-xl bg-slate-100" data-cancel="${b.id}">Cancel</button>
            <button class="px-4 py-2 rounded-xl bg-fix-500 text-white" data-rebook="${b.providerId}">Rebook</button>
          </div>
        </div>
      `).join('') || `<div class="text-slate-600">No bookings yet.</div>`;

      list.querySelectorAll('[data-cancel]').forEach(btn=>btn.addEventListener('click',()=>{
        const id = btn.dataset.cancel;
        const bk = state.bookings.find(x=>x.id===id); if(!bk) return;
        bk.status = 'Cancelled'; db.save(state); renderBookings();
      }));

      list.querySelectorAll('[data-rebook]').forEach(btn=>btn.addEventListener('click',()=>openBookModal(btn.dataset.rebook)));
    }

    // ------- Post a request modal -------
    function openPostModal(){
      document.getElementById('post-modal').classList.remove('hidden');
      document.getElementById('post-modal').classList.add('flex');
    }
    function closePostModal(){
      document.getElementById('post-modal').classList.add('hidden');
      document.getElementById('post-modal').classList.remove('flex');
    }

    document.getElementById('post-close').addEventListener('click', closePostModal);
    document.getElementById('req-cancel').addEventListener('click', e=>{ e.preventDefault(); closePostModal(); });

    // ------- Event bindings -------
    function bindEvents(){
      document.getElementById('search-form').addEventListener('submit', e=>{
        e.preventDefault();
        const qS = document.getElementById('q-service').value.toLowerCase();
        const qL = document.getElementById('q-location').value.toLowerCase();
        const items = state.providers.filter(p => (
          !qS || p.category.toLowerCase().includes(qS) || p.name.toLowerCase().includes(qS)
        ) && (!qL || p.location.toLowerCase().includes(qL)));

        document.getElementById('filter-category').value = '';
        document.getElementById('filter-location').value = '';
        document.getElementById('sort-by').value = 'top';
        const grid = document.getElementById('providers-grid');
        grid.innerHTML = items.map(p=>`
          <article class="bg-white rounded-2xl p-5 border border-slate-200 shadow-soft">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h3 class="text-lg font-bold">${p.name}</h3>
                <div class="mt-1 text-slate-600">${p.category} • ${p.location}</div>
                <div class="mt-2 flex items-center gap-2">${starRating(p.rating)} ${p.verified?badge('Verified','fix'):''}</div>
              </div>
              <div class="text-right">
                <div class="text-xl font-extrabold">LKR ${fmt(p.rate)}</div>
                <div class="text-sm text-slate-600">per hour</div>
              </div>
            </div>
            <p class="mt-3 text-slate-700">${p.bio}</p>
            <div class="mt-3 text-sm text-slate-600">Languages: ${p.languages||'—'}</div>
            <div class="mt-4 flex gap-2">
              <button class="px-4 py-2 rounded-xl bg-fix-500 text-white font-semibold" data-book="${p.id}">Book</button>
            </div>
          </article>
        `).join('') || `<div class="col-span-full text-[#E6FFF1]">No results for your search.</div>`;

        document.querySelectorAll('#providers-grid [data-book]').forEach(btn=>btn.addEventListener('click',()=>openBookModal(btn.dataset.book)));
        location.hash = '#browse';
      });

      document.getElementById('filter-category').addEventListener('change', renderProviders);
      document.getElementById('filter-location').addEventListener('change', renderProviders);
      document.getElementById('sort-by').addEventListener('change', renderProviders);

      document.getElementById('btn-post').addEventListener('click', openPostModal);
      document.getElementById('btn-post-2').addEventListener('click', openPostModal);

      document.getElementById('request-form').addEventListener('submit', e=>{
        e.preventDefault();
        const r = {
          id: 'r'+Date.now(),
          title: document.getElementById('req-title').value,
          location: document.getElementById('req-location').value,
          budget: Number(document.getElementById('req-budget').value||0),
          date: document.getElementById('req-date').value,
          contact: document.getElementById('req-contact').value,
          details: document.getElementById('req-details').value
        };
        state.requests.unshift(r); db.save(state); renderRequests(); closePostModal();
      });

      document.getElementById('pro-form').addEventListener('submit', e=>{
        e.preventDefault();
        const p = {
          id: 'p'+Date.now(),
          name: document.getElementById('pro-name').value,
          phone: document.getElementById('pro-phone').value,
          category: document.getElementById('pro-category').value,
          location: document.getElementById('pro-location').value,
          rate: Number(document.getElementById('pro-rate').value||0),
          rating: 5.0,
          verified: document.getElementById('pro-verified').checked,
          languages: document.getElementById('pro-languages').value,
          bio: document.getElementById('pro-bio').value
        };
        state.providers.unshift(p); db.save(state);
        document.getElementById('pro-form').reset();
        renderProviders();
        alert('Profile created! Your listing is now live.');
        location.hash = '#browse';
      });
    }

    // ------- Router (hash-based) -------
    function showSection(hash){
      const id = hash.replace('#','') || 'home';
      ['home','browse','requests','become-pro','bookings'].forEach(sec=>{
        const el = document.getElementById(sec);
        if(!el) return;
        if (sec==='home') {
          document.querySelector('header').style.display = '';
        }
        el.style.scrollMarginTop = '80px';
      });
      const target = document.getElementById(id);
      if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    window.addEventListener('hashchange', ()=>showSection(location.hash));

    // ------- Boot -------
    function boot(){
      initFilters();
      renderProviders();
      renderRequests();
      renderBookings();
      bindEvents();
      document.getElementById('year').textContent = new Date().getFullYear();
      showSection(location.hash || '#home');
    }

    document.addEventListener('DOMContentLoaded', boot);

    // Bell click handler
    document.getElementById('notify-btn-nav')?.addEventListener('click', () => {
      alert('You have 3 new notifications (simulated).');
      document.getElementById('notify-badge')?.classList.add('hidden');
    });
  </script>
</body>
</html>
